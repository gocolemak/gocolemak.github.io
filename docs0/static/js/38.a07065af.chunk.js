(this["webpackJsonpmoderate-react-ts"]=this["webpackJsonpmoderate-react-ts"]||[]).push([[38],{1741:function(n,t,e){"use strict";e.r(t),t.default="# \u524d\u7aef mock\n\u73b0\u5728\u5f00\u53d1\u6a21\u5f0f\u4e00\u822c\u90fd\u662f\u524d\u540e\u7aef\u5206\u79bb\uff0c\u90a3\u5c31\u514d\u4e0d\u4e86\u4e92\u76f8\u201c\u8fc1\u5c31\u201d\uff0c\u6bd4\u5982\u8bf4\u540e\u53f0\u53ea\u628a\u63a5\u53e3\u6587\u6863\u5927\u4f53\u5b9a\u597d\u4e86\uff0c\u63a5\u53e3\u8fd8\u6ca1\u51fa\uff0c\u4f5c\u4e3a\u524d\u7aef\u7684\u4e0d\u80fd\u50bb\u7b49\u7740\u554a\uff0c\u4f46\u662f\u4e0d\u8054\u8c03\u7684\u53bb\u5f00\u53d1\uff0c\u5f88\u591a\u7ec6\u8282\u5c31\u7167\u987e\u4e0d\u5230\uff0c\u5f88\u5bb9\u6613\u5c31\u51fa\u73b0\u4e34\u8fd1\u5feb\u4ea4\u5de5\u7684\u65f6\u5019\u624d\u51fa\u63a5\u53e3\uff08\u8fd9\u91cc\u4e0d\u80fd\u72ed\u9698\u7684\u8ba4\u4e3a\u540e\u53f0\u6545\u610f\u5730\uff0c\u5c31\u662f\u83dc\u800c\u5df2\uff09\uff0c\u5f53\u8054\u8c03\u7684\u65f6\u5019\u624d\u53d1\u73b0\u5f88\u591a\u95ee\u9898\uff0c\u90a3\u5c31\u592a\u5c34\u5c2c\u4e86\uff0c\u5982\u679c\u5ef6\u8bef\u4e86\uff0c\u9505\u5f88\u5bb9\u6613\u5c31\u76d6\u5728\u4e86\u524d\u7aef\u7684\u5934\u4e0a\uff0c\u5f97\u60f3\u4e2a\u8f99\uff1a\n\n* \u201c\u8bf7\u201d\u540e\u53f0\u52a0\u5feb\u901f\u5ea6\u5e76\u4fdd\u8bc1\u8d28\u91cf\uff0c\u8fd9\u662f\u4e00\u79cd\u529e\u6cd5\uff0c\u6bcf\u6b21\u90fd\u8981\u5631\u6258\u4e00\u4e0b\uff0c\u62dc\u6258\u62dc\u6258\u3002(\u5f80\u5f80\u6ca1\u4ec0\u4e48\u5375\u7528\u56fe\u4e2a\u5fc3\u5b89\u3002\u3002\u3002)\n* \u81ea\u5df1mock\u63a5\u53e3\uff0c\u66f4\u597d\u5730\u548c\u540e\u53f0\u201c\u5f02\u6b65\u201d\u5f00\u53d1\uff0c\u5feb\u901f\u63a8\u8fdb\u524d\u7aef\u5de5\u4f5c\u8fdb\u5ea6\uff0c\u5c3d\u65e9\u7684\u66b4\u9732\u95ee\u9898\uff0c\u7ed9\u81ea\u5df1\u4e89\u53d6\u66f4\u591a\u7684\u65f6\u95f4\u53bb\u89e3\u51b3\u3002\n\n---\n\n# \u600e\u4e48\u7528 mock\n\n\u9996\u5148\u5b89\u88c5`mockjs`\n\n```shell\n\tyarn add -D mockjs\n```\n\n\n\u7136\u540e\u770b\u4e00\u4e0b\u81ea\u5df1\u7684\u7f51\u7edc\u8bf7\u6c42\u5e93\u7528\u7684\u662f\u5565\uff1a\n\n__axios__:\n```js\n\t...\n\timport Mock from 'mockjs'\n\t...\n\t\n\tMock.mock(apiUrl, mock)\n\t...\n```\n\n__fetch__\uff1a\u5c31\u5f97\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\n\n\u9996\u5148\u5b89\u88c5`mockjs-fetch`\n```shell\n\tyarn add -D mockjs-fetch\n```\n\n\u7136\u540e\n```js\n\t...\n\timport Mock from 'mockjs'\n        import mockFetch from 'mockjs-fetch';\n        mockFetch(Mock);\n\t...\n\tMock.mock(apiUrl, mock)\n```\n\n\u5230\u6b64\u57fa\u672c\u64cd\u4f5c\u5c31\u641e\u5b9a\u4e86\uff0c\u4f46\u8fd9\u8fd8\u4e0d\u591f\u3002\n\n---\n\n# \u600e\u4e48\u4f18\u96c5\u7684\u7528 mock\n\n\u6211\u770b\u8fc7\u5f88\u591a\u7684\u9879\u76ee\uff0c\u5f80\u5f80\u662f\u5199\u4e86\u4e00\u5806\u3002\u3002\u3002\u3002\u6817\ud83c\udf30\uff1a\n\n```js\nimport Mock from 'mockjs'\nimport { builder, getBody } from '../util'\n\nconst login = options => {\n  const body = getBody(options)\n  return builder(\n    {\n      id: Mock.mock('@guid'),\t\t\t//\u8fd9\u4e2a@\u662fmockJs\u7684\u5360\u4f4d\u7b26\uff0c\u53ef\u4ee5\u5230\u5b98\u7f51\u4e86\u89e3\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u4e0d\u91cd\u8981\uff0c\u6211\u4eec\u4e3b\u8981codeReview\n      name: Mock.mock('@name'),\n      username: 'admin',\n      password: '',\n      avatar:\n        'https://gw.alipayobjects.com/zos/rmsportal/jZUIxmJycoymBprLOUbT.png',\n      status: 1,\n      telephone: '',\n      lastLoginIp: '27.154.74.117',\n      lastLoginTime: 1534837621348,\n      creatorId: 'admin',\n      createTime: 1497160610259,\n      deleted: 0,\n      roleId: 'admin',\n      lang: 'zh-CN',\n      token: '4291d7da9005377ec9aec4a71ea837f'\n    },\n    '',\n    200\n  )\n}\n\n\n\nMock.mock(/\\/auth\\/login/, 'post', login)\n\n```\n\n\n\u9996\u5148\u54b1\u4eec\u54c1\u8bc4\u4e00\u4e0b\uff0c\u4e0d\u77e5\u9053\u662f\u4e0d\u662f\u6211\u7684\u201c\u5ba1\u7f8e\u201d\u602a\uff0c\u6211\u770b\u8fd9\u6837\u7684\u4ee3\u7801\u591a\u5c11\u6709\u70b9\u522b\u626d\u3002\n\n## codeReview\u4e00\u4e0b\uff1a\n\n1. \u9996\u5148\u5728\u5934\u90e8\u5f15\u5165\u4e86`mockjs`\n2. \u7136\u540e\u5f15\u5165\u4e86\u4e24\u4e2a\u5de5\u5177\u51fd\u6570,\u54b1\u5148\u4e0d\u7ba1\u5e72\u561b\u7684\n\t```js\n\timport { builder, getBody } from '../util'\n\t```\n3. `Mock.mock(/\\/auth\\/login/, 'post', login)`\u7136\u540e\u6267\u884c\u4e86mock\n\n__\u8bc4\u4ef7__\uff1a\n1. em\uff5e\uff5e\uff5e\uff0c\u6bcf\u5199\u4e00\u4e2amock\u6a21\u5757\u5c31\u5f15\u4e00\u4e0b`mockjs`\u5e93\uff0c\u91cd\u590d\u4e86\u867d\u7136\u5c31\u4e00\u6761\uff0c__\u4f46\u8fd8\u7b97\u80fd\u5fcd__\u3002\n2. em\uff5e\uff5e\uff5e\uff0c\u4e3a\u5565\u8981\u5f15\u5de5\u5177\u51fd\u6570\u5462\uff0c\u4e3a\u5565\u8fd8\u8981\u4e86\u89e3\u5de5\u5177\u51fd\u6570\uff0c\u8fd8\u662f\u4e24\u4e2a\uff01\u5982\u679c\u4e3a\u4e86\u5b9e\u73b0\u8d85\u51fa\u57fa\u672cmock\u7684\u529f\u80fd\u8303\u7574\uff0c\u90a3\u8bb2\u4e0d\u4e86\uff0c\u4f46\u5c31\u662f __\u5355\u7eafmock__ \uff0c\u8fd9\u5c31\u6709\u70b9\u3002\u3002\u3002\uff0c__\u96be\u5fcd\u4e86__\u3002\n3. what\uff01\uff01\uff01\uff0cmock\u7684\u63a5\u53e3\u5730\u5740\u5c45\u7136\u201c\u786c\u4e86\u201d\uff0c\u60f3\u60f3\u786c\u7f16\u7801\u6240\u652f\u914d\u7684\u6050\u60e7\uff0c\u8fd9\u7b80\u76f4\uff0c__\u4e0d\u80fd\u5fcd\uff0c\u4e0d\u80fd\u5fcd__ \uff01\uff01\uff01\n\n__\u603b\u7ed3__\uff1a\n\n\u91cd\u590d\uff08\u54ea\u6015\u53ea\u6709\u51e0\u6761\uff09\uff0c\u5173\u6ce8\u7684\u70b9\u591a\uff08\u54ea\u6015\u53ea\u6709\u51e0\u4e2a\uff09\uff0c\u786c\u7f16\u7801\uff08\u54ea\u6015\u53ea\u6709\u4e00\u5904\uff09\uff0c\u6709\u80fd\u529b\u91cd\u6784\u5c31\u4e0d\u80fd\u5fcd\uff0c\u6211\u4eec\u53ea\u662f\u60f3mock\u6570\u636e\uff0c\u76f4\u63a5\u70b9\uff0c\u81ea\u7136\u4e00\u70b9\u4e0d\u597d\u4e48\uff0c\u5c31\u50cf\u5b57\u9762\u90a3\u6837\uff0c\u6211\u60f3\u201cmock\u201d\u4e00\u4e2a\u201capi\u201d\u3002\n\n\n\n## \u5982\u679c\u4e00\u4e2aapi\u662f\u8fd9\u6837\u7684\uff1a\n\n```js\nimport BaseApi from './baseApi'\n\nlet config = {\n    fetchLightAdd: \"/light/fetchLightAdd\",\n    fetchLightUpdate: \"/light/fetchLightUpdate\",\n    fetchLightDetail: \"/light/fetchLightDetail\",\n    fetchTestDataList: \"/light/fetchTestDataList\",\n}\n\nexport default new BaseApi({ config })\n```\n\n## \u90a3\u4e48\u671f\u671bmock\u7684\u6837\u5b50\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff1a\n\n```js\nimport BaseMock from './baseMock'\n\nlet config = {\n    fetchLightAdd: {\n       ...\n    },\n    fetchLightUpdate: {\n       ...\n    },\n    fetchLightDetail: (data) => {\n        const { body = {} } = data;\n        let params = JSON.parse(body);\n        //\u5728\u8fd9\u91cc\u5c31\u5404\u79cd\u6a21\u62df\u5165\u53c2\u60c5\u51b5\u53d1\u6325\u4e0d\u540c\u7ed3\u679c\u3002\n        if (params.id === \"0\") {\n            return {\n                code: \"200\",\n                data: [{\n                    lightName: \"test_lightName_0\",\n                    comment: \"test_comment_0\",\n                    lightItems: [{ lightItemId: 1, lightType: 0, baseSelect: 1, exclude: false }]\n                }]\n            }\n        } else if (params.id === \"1\") {\n            return {\n                code: \"200\",\n                data: [{\n                    lightName: \"test_lightName_1\",\n                    comment: \"test_comment_1\",\n                    lightItems: [{ lightItemId: 1, lightType: 0, baseSelect: 0, exclude: 0 }, { lightItemId: 2, lightType: 1, baseSelect: 1, exclude: false }]\n                }]\n            }\n        }\n\n    },\n    fetchTestDataList: {\n        ...\n    }\n}\n\nexport default function mock(api) {\n    new BaseMock({ config, apiConfig: api.getUrlConfig() })\n}\n\n```\n\n## \u6211\u4eec\u518dcodeReview\u4e00\u4e0b\uff1a\n\n1. \u9996\u5148\u6bcf\u4e2a\u6587\u4ef6\u90fd\u5f15\u5165\u4e86mockjs\uff1a\u89e3\u51b3\ud83c\udd97\uff0cem\uff5e\uff5e\uff5e\u53ea\u4e0d\u8fc7\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u5f15\u5165\u4e86`BaseMock`\ud83d\ude02\uff0c\uff08\u672c\u6765\u8fd9\u53e5\u6211\u90fd\u60f3\u7701\uff0c\u4f46\u5c31\u62c5\u5fc3\u4ee3\u7801\u641e\u7684\u4e0d\u597d\u61c2\u4e86\uff0c\u8981\u4e0d\u6211\u5dee\u70b9\u62d4\u5200\ud83d\udc36\uff09\n2. \u5173\u6ce8\u70b9\u591a\uff1a\u89e3\u51b3\ud83c\udd97\n3. \u786c\u7f16\u7801\uff1a\u89e3\u51b3\ud83c\udd97\n\n__\u603b\u7ed3__\uff1a\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u6570\u636e\u7ed3\u6784\uff0c\u63d0\u4f9b\u7ed9\u4f60\uff0c\u914d\u5c31\u5b8c\u4e86\uff0c\u60f3mock\u54ea\u4e2a\u63a5\u53e3\uff0c\u5c31\u5199\u8fd9\u4e2a\u63a5\u53e3\u540d\u5b57\uff0c\u771f\u662f\u5b57\u9762\u90a3\u6837\uff1a\u6211\u60f3\u201cmock\u201d\u4e00\u4e2a\u201capi\u201d\uff0c\u5176\u4ed6\u4e0d\u9700\u8981\u4f60\u5173\u6ce8\u4e86\uff0c\u5c31\u8fd9\u4e48\u7b80\u5355\u4e14\u81ea\u7136\u3002\n\n---\n\n# \u522b\u5fd8\u4e86 mock \u53ea\u5728\u5f00\u53d1\u6a21\u5f0f\u7528\u3002\n\n## \u6839\u636e\u73af\u5883\u52a8\u6001\u5f15\u5165\uff1a\n\n```js\n{\n    /* \u914d\u7f6emock\u542f\u52a8 */\n    const { NODE_ENV, MOCK } = process.env;\n    if (NODE_ENV === \"development\") {\n        if (MOCK != \"none\") {\n            require('MOCK');\n        }\n    }\n}\n```\n\n## \u53d1\u5e03\u6253\u5305\u7684\u65f6\u5019\u53bb\u6389\uff0c\u5305\u4f53\u5c0f\u70b9\u4e0d\u597d\u4e48\uff1a\n\n\u914d\u7f6ewebpak\u7684\u9009\u9879\uff1a\n```js\n //isEnvProduction\u6839\u636eprocess.env.NODE_ENVde\u503c\u5224\u65ad\u5f97\u5230\u7684\n externals:isEnvProduction?{\n            mockjs:mockjs\n }:{}\n```\n\n## \u6253\u5305\u6211\u4eec\u770b\u4e0b\uff1a\n\n\u9996\u5148[Moderate](https://juejin.cn/post/6974675882841473038)\u6253\u5305\u901f\u5ea6\u8fd8\u662f\u5f88\u5feb\u7684\uff0c\u624d21s\uff0c\u563f\u563f\ud83d\ude01\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe0923e60be94245b32d45179e6264e8~tplv-k3u1fbpfcp-zoom-1.image)\n\n\u7136\u540e\u770b\u4e0b\u62a5\u544a\uff1a\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a00d43d3181f47d1b844d03b420ceec9~tplv-k3u1fbpfcp-zoom-1.image)\n\n---\n\n# \u7ed3\u8bed\n\n\u8981\u6c42\u522b\u4eba\u4e0d\u5982\u8981\u6c42\u81ea\u5df1\u6765\u7684\u5b9e\u9645,mock\u786e\u5b9e\u80fd\u7f13\u89e3\u4e0d\u5c11\u538b\u529b\uff0c\u524d\u7aef\u4e0d\u5bb9\u6613\uff0cta\u7684\u96be\u8fd8\u4e0d\u662f\u90a3\u79cd\uff5e\uff5e\uff5e\u96be\uff0cta\u771f\u7684\u662f\u90a3\u79cd\uff0c\u90a3\u79cd\u5f88\u5c11\u89c1\u7684\u90a3\u79cd\uff0c\u795e\u7ecf\u75c5\u4e00\u6837\u7684\u96be\u5ea6\u3002\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7a3618b450ad4c4ab84c9029c946bcbf~tplv-k3u1fbpfcp-zoom-1.image)\n\n\n[\u8d2f\u5f7b\u601d\u60f3\u7684\ud83c\udf30](https://github.com/moderateReact/moderate-react-template)\n\n"}}]);