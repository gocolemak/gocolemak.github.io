(this["webpackJsonpmoderate-react-ts"]=this["webpackJsonpmoderate-react-ts"]||[]).push([[5],{1675:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A}));n(772);var i=n(521),r=(n(433),n(196)),a=(n(310),n(129)),o=(n(432),n(149)),d=n(98),s=n(18),l=n(136),c=n(42),h=n(47),u=n(55),p=n(54),f=n(0),g=n.n(f),m=n(1661),v=n(246),b=n(16),y=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"getInPorts",value:function(){return this.getPortsByGroup("in")}},{key:"getOutPorts",value:function(){return this.getPortsByGroup("out")}},{key:"getUsedInPorts",value:function(e){var t=this;return(e.getIncomingEdges(this)||[]).map((function(e){var n=e.getTargetPortId();return t.getPort(n)}))}},{key:"getNewInPorts",value:function(e){return Array.from({length:e},(function(){return{group:"in"}}))}},{key:"updateInPorts",value:function(e){return this}}]),n}(m.g.Rect),x="1",j="0",w="2";function N(e){return e.getProp("position")}var O={groups:{out:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},in:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"in",id:"port_in_1"},{group:"out",id:"port_out_1"}]},k=function(){function e(t){var n,i;Object(c.a)(this,e),this.graph=void 0,this.dndNodeF=void 0,this.nodeF=void 0,this.addNndNodeA=function(e){var t=Object(s.a)({inherit:"rect",width:66,height:36,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF",rx:5},text:{fontSize:12,color:"#262626"}},ports:Object(s.a)({},O),label:"\u5ba1\u6279",data:e},e);return new y(t)},this.addNndNodeB=function(e){var t=Object(s.a)({inherit:"rect",width:66,height:36,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF",rx:20},text:{fontSize:12,color:"#262626"}},ports:Object(s.a)({},O),label:"\u7ed3\u675f",data:e},e);return new y(t)},this.addNndNodeC=function(e){var t=Object(s.a)({inherit:"circle",width:56,height:56,attrs:{body:{strokeWidth:1,stroke:"#f2763b",fill:"#f1bfbf",rx:28},textWrap:{text:"lorem ipsum dolor sit amet consectetur adipiscing elit",width:-10,height:"50%",ellipsis:!0,breakWord:!0}},ports:Object(s.a)({},O),label:"\u521b\u5efa",data:e},e);return new y(t)},this.getNodeA=function(e){return new y(e)},this.getNodeB=function(e){var t;return(null===e||void 0===e?void 0:e.ele)?((t=e.ele).style.margin="16px",t.style.cursor="move"):t=document.createElement("div"),t.style.width="120px",t.style.height="40px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.border="2px solid rgb(49, 208, 198)",t.style.background="#fff",t.style.borderRadius="20px",t.innerText="Circle",t},this.getNodeC=function(e){var t;return(null===e||void 0===e?void 0:e.ele)?((t=e.ele).style.margin="16px",t.style.cursor="move"):t=document.createElement("div"),t.style.width="80px",t.style.height="80px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.border="2px solid rgb(49, 208, 198)",t.style.background="#fff",t.style.borderRadius="100%",t.innerText="Circle",t},this.graph=t.graph,this.dndNodeF=(n={},Object(b.a)(n,x,this.addNndNodeA),Object(b.a)(n,w,this.addNndNodeB),Object(b.a)(n,j,this.addNndNodeC),n),this.nodeF=(i={},Object(b.a)(i,x,this.getNodeA),Object(b.a)(i,w,this.getNodeB),Object(b.a)(i,j,this.getNodeC),i)}return Object(h.a)(e,[{key:"addNode",value:function(e){var t=(e||{}).options;return t?this.graph.addNode(t):this.graph.addNode(this.addNndNodeA())}},{key:"addNodeByType",value:function(e){var t=e.type,n=e.options;return t in this.dndNodeF?this.dndNodeF[t](n||{type:t}):this.addNndNodeA(n||{type:t})}},{key:"getNode",value:function(e){var t=e.type,n=e.ele;return t in this.nodeF?this.nodeF[t]({ele:n}):this.getNodeA({ele:n})}}]),e}(),C=n(1712),_=n.n(C),I=n(44),E=n(11),F=["itemData"],A=function(e){Object(u.a)(n,e);var t=Object(p.a)(n);function n(e){var i;Object(c.a)(this,n),(i=t.call(this,e)).graph=void 0,i.nodeCtr=void 0,i.minimapContainer=void 0,i.magnetAvailabilityHighlighter=void 0,i.formInstance=void 0,i.nodeArr=void 0,i.nodePosArrTemp=void 0,i.isDragFlag=void 0,i.currentNodeId=void 0,i.isBefore=void 0,i.flowId=void 0,i.toRequestData=function(){return new Promise((function(e){e({})}))},i.preWork=function(){var e=document.getElementById("container"),t=document.createElement("div");t.id="stencil2";var n=document.createElement("div");n.id="graph-container",e.appendChild(t),e.appendChild(n),Object(v.insertCss)("\n      #container {\n        display: flex;\n        border: 1px solid #dfe3e8;\n      }\n      #stencil2 {\n        width:200px;\n        height: 100%;\n        position: relative;\n        border-right: 1px solid #dfe3e8;\n      }\n      #graph-container {\n        width: calc(100%);\n        height: 100%!important;\n      }\n      .x6-widget-stencil  {\n        background-color: #fff;\n      }\n      .x6-widget-stencil-title {\n        background-color: #fff;\n      }\n      .x6-widget-stencil-group-title {\n        background-color: #fff !important;\n      }\n      .x6-widget-transform {\n        margin: -1px 0 0 -1px;\n        padding: 0px;\n        border: 1px solid #239edd;\n      }\n      .x6-widget-transform > div {\n        border: 1px solid #239edd;\n      }\n      .x6-widget-transform > div:hover {\n        background-color: #3dafe4;\n      }\n      .x6-widget-transform-active-handle {\n        background-color: #3dafe4;\n      }\n      .x6-widget-transform-resize {\n        border-radius: 0;\n      }\n      .x6-widget-selection-inner {\n        border: 1px solid #239edd;\n      }\n      .x6-widget-selection-box {\n        opacity: 0;\n      }\n    ")},i.showPorts=function(e,t){for(var n=0,i=e.length;n<i;n+=1)e[n].style.visibility=t?"visible":"hidden"},i.handleSummit=function(){history.back()},i.toRegisterEvent=function(){var e=function(e){var t=e.cell;t instanceof y&&(t.getInPorts().forEach((function(t){var n=e.findPortElem(t.id,"portBody");e.unhighlight(n,{highlighter:i.magnetAvailabilityHighlighter})})),t.updateInPorts(i.graph))};i.graph.on("edge:connected",(function(t){var n=t.previousView,i=t.currentView;n&&e(n),i&&e(i)})),i.graph.on("edge:removed",(function(e){var t=e.edge;if(e.options.ui){var n=t.getTargetCell();n instanceof y&&n.updateInPorts(i.graph)}})),i.graph.on("node:mouseenter",(function(e){e.node;var t=document.getElementById("graph-container").querySelectorAll(".x6-port-body");i.showPorts(t,!0)})),i.graph.on("node:mouseleave",(function(e){e.node;var t=document.getElementById("graph-container").querySelectorAll(".x6-port-body");i.showPorts(t,!1)})),i.graph.on("node:click",(function(e){e.e,e.x,e.y;var t=e.cell;e.view.highlight();var n=t.data,r=n.idL,a=n.type;i.setState({currentItemId:r,isCheckNode:a==x},(function(){var e,t,n=i.state.nodeList.find((function(e){return e.idL===i.state.currentItemId}));null===(e=i.formInstance)||void 0===e||null===(t=e.current)||void 0===t||t.setFieldsValue(n)}))})),i.graph.on("cell:mouseup",(function(e){e.view.unhighlight()})),i.graph.on("cell:mouseleave",(function(e){e.view.unhighlight()})),i.graph.on("cell:mouseover",(function(e){e.view.unhighlight()})),document.addEventListener("mousemove",(function(e){if(i.isDragFlag){var t=e.pageX,n=e.pageY,r=i.graph.pageToLocal(t,n),a=[],o={};if(!i.nodePosArrTemp.length)return;i.nodePosArrTemp.forEach((function(e){var t,n=e.itemData,d=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}(Object(l.a)(e,F),r);a.push(d),o[d]=n,null===(t=i.graph.findViewByCell(n))||void 0===t||t.unhighlight()}));var d=Math.min.apply(Math,a),s=o[d];if(r.x>N(s).x){if(d>100)return}else if(d>50)return;var c=i.graph.findViewByCell(s);null===c||void 0===c||c.highlight(),i.currentNodeId=s.data.idL,i.isBefore=!0,r.x>N(s).x?i.isBefore=Math.abs(r.x-N(s).x)<s.size().width/2:i.isBefore=!0}}))},i.refContainer=function(e){},i.refMiniMapContainer=function(e){i.minimapContainer=e},i.handleFormChange=function(e){console.log("Received values of form: ",e),"auditUserEditable"in e&&(e.auditUserEditable?e.auditUserEditable=1:e.auditUserEditable=0),"formDataEditable"in e&&(e.formDataEditable?e.formDataEditable=1:e.formDataEditable=0),i.state.nodeList.find((function(t){t.idL===i.state.currentItemId&&Object.assign(t,e)})),i.toRecoveryView()},i.state={isRefresh:0,currentItemId:"",isCheckNode:!0,operatorList:[],nodeList:[i.getNodeTempByType(j),i.getNodeTempByType(w)],flowName:""},i.formInstance=g.a.createRef();var r=e.location.search;return i.flowId=Object(I.f)(r,"id"),i}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.location,this.toRequestData().then((function(){e.magnetAvailabilityHighlighter={name:"stroke",args:{attrs:{fill:"#fff",stroke:"#47C769"}}},e.preWork(),e.graph=e.createGraph(),e.nodeCtr=new k({graph:e.graph}),e.toRecoveryView(),e.toRegisterEvent(),e.initStenCil(),e.setState({isRefresh:Date.now()})}))}},{key:"getNodeTempByType",value:function(e){return e==x?{idL:Object(I.m)(),type:x,name:"\u5ba1\u6279",auditUserId:1,auditUserEditable:0,formDataEditable:0,valid:1}:e==w?{idL:Object(I.m)(),type:w,name:"\u7ed3\u675f",auditUserId:1,auditUserEditable:0,formDataEditable:0,valid:1}:e==j?{idL:Object(I.m)(),type:j,offsetY:-10,name:"\u5f00\u59cb",auditUserId:1,auditUserEditable:0,formDataEditable:0,valid:1}:{idL:Object(I.m)(),type:x,name:"\u5ba1\u6279",auditUserId:1,auditUserEditable:0,formDataEditable:0,valid:1}}},{key:"initStenCil",value:function(){var e=this,t=new m.a.Stencil({title:"\u6d41\u7a0b\u56fe",target:this.graph,stencilGraphWidth:200,stencilGraphHeight:240,collapsable:!1,groups:[{title:"\u57fa\u7840\u6d41\u7a0b\u56fe",name:"group1",collapsable:!1}],layoutOptions:{columns:1,columnWidth:150,rowHeight:80},getDragNode:function(t){return e.isDragFlag=!0,e.nodePosArrTemp=[],e.nodeArr.forEach((function(t){var n=N(t);e.nodePosArrTemp.push(Object(s.a)(Object(s.a)({},n),{},{itemData:t}))})),t.clone({keepId:!0})},getDropNode:function(t){return e.isDragFlag=!1,e.nodePosArrTemp=[],t.clone({keepId:!0})},validateNode:function(t,n){var i=e.state.nodeList,r=Object(d.a)(i),a=i.findIndex((function(t){return e.currentNodeId===t.idL}));return t.data.type!==x||(0===a?r.splice(a+1,0,e.getNodeTempByType(t.data.type)):a===r.length-1?r.splice(a,0,e.getNodeTempByType(t.data.type)):r.splice(e.isBefore?a:a+1,0,e.getNodeTempByType(t.data.type)),e.setState({nodeList:r},(function(){e.toRecoveryView()}))),!1}});document.getElementById("stencil2").appendChild(t.container);var n=this.nodeCtr.addNodeByType({type:x}),i=this.nodeCtr.addNodeByType({type:w}),r=this.nodeCtr.addNodeByType({type:j});t.load([r,n,i],"group1")}},{key:"getNodeCtr",value:function(){return this.nodeCtr}},{key:"createGraph",value:function(){var e=this;return new m.c({scroller:{enabled:!0},minimap:{enabled:!0,container:this.minimapContainer,width:300},mousewheel:{enabled:!0},grid:!0,container:document.getElementById("graph-container"),highlighting:{magnetAvailable:this.magnetAvailabilityHighlighter,magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#fff",stroke:"#31d0c6"}}}},connecting:{snap:!0,allowBlank:!1,allowLoop:!1,highlight:!0,connector:"rounded",connectionPoint:"boundary",router:"orth",createEdge:function(){return new m.g.Edge({attrs:{line:{stroke:"#5217b1",strokeWidth:1,targetMarker:{name:"classic",size:7}}}})},validateConnection:function(t){t.sourceView;var n=t.targetView,i=t.targetMagnet;if(!i)return!1;if("in"!==i.getAttribute("port-group"))return!1;if(n){var r=n.cell;if(r instanceof y){var a=i.getAttribute("port");if(r.getUsedInPorts(e.graph).find((function(e){return e&&e.id===a})))return!1}}return!0}}})}},{key:"toRecoveryView",value:function(){this.graph.clearCells();var e=50;this.nodeArr=[];for(var t=this.state.nodeList,n=0;n<t.length;n++){var i=t[n],r=i.type,a=r==j?-10:0,o=this.nodeCtr.addNodeByType({type:r,options:{data:i,label:i.name}}).position(e+120*n,150+a).setAttrs({label:{textAnchor:"middle",text:i.name,textWrap:{width:60,height:32,ellipsis:!0}}});this.nodeArr.push(this.graph.addNode(o))}for(var d=0;d<this.nodeArr.length;d++)d<this.nodeArr.length-1&&this.graph.addEdge({source:{cell:this.nodeArr[d],port:"port_out_1"},target:{cell:this.nodeArr[d+1],port:"port_in_1"},attrs:{line:{stroke:"#5217b1",strokeWidth:1,targetMarker:{name:"classic",size:7}}}})}},{key:"render",value:function(){return Object(E.jsx)("div",{className:_.a.app,children:Object(E.jsxs)("div",{style:{display:"flex"},children:[Object(E.jsx)("div",{className:_.a["app-content"],id:"container",ref:this.refContainer}),Object(E.jsxs)("div",{className:_.a["app-content-right"],children:[Object(E.jsxs)("div",{className:_.a["app-infoEdit"],children:[Object(E.jsx)("div",{children:"\u8282\u70b9\u8bbe\u7f6e"}),this.state.currentItemId&&Object(E.jsxs)(a.a,{labelCol:{span:12},wrapperCol:{span:9,offset:1},layout:"horizontal",onValuesChange:this.handleFormChange,ref:this.formInstance,children:[Object(E.jsx)(a.a.Item,{style:{marginBottom:5},name:"type",label:"\u8282\u70b9\u7c7b\u578b",children:Object(E.jsxs)(o.a,{disabled:!this.state.isCheckNode,children:[Object(E.jsx)(o.a.Option,{value:x,children:"\u5ba1\u6838"}),Object(E.jsx)(o.a.Option,{value:j,children:"\u521b\u5efa"}),Object(E.jsx)(o.a.Option,{value:w,children:"\u7ed3\u675f"})]})}),Object(E.jsx)(a.a.Item,{name:"name",className:_.a["custom-form-item"],label:"\u8282\u70b9\u540d\u79f0",children:Object(E.jsx)(r.a,{disabled:!this.state.isCheckNode})}),this.state.isCheckNode&&Object(E.jsxs)("div",{children:[Object(E.jsx)(a.a.Item,{name:"auditUserId",className:_.a["custom-form-item"],label:"\u64cd\u4f5c\u4eba",children:Object(E.jsx)(o.a,{children:this.state.operatorList.map((function(e){return Object(E.jsx)(o.a.Option,{value:e.id,children:e.companyName})}))})}),Object(E.jsx)(a.a.Item,{valuePropName:"checked",name:"auditUserEditable",className:_.a["custom-form-item"],label:"\u5ba1\u6838\u4eba\u662f\u5426\u53ef\u4fee\u6539",children:Object(E.jsx)(i.a,{})}),Object(E.jsx)(a.a.Item,{valuePropName:"checked",name:"formDataEditable",className:_.a["custom-form-item"],label:"\u8868\u5355\u6570\u636e\u662f\u5426\u53ef\u4fee\u6539",children:Object(E.jsx)(i.a,{})})]})]})]}),Object(E.jsx)("div",{className:_.a["app-minimapContainer"],id:"minimapContainer",ref:this.refMiniMapContainer})]})]})})}}]),n}(g.a.Component)},1712:function(e,t,n){e.exports={app:"flow_app__2gwaC",top:"flow_top__i8O3u","custom-form-item":"flow_custom-form-item__3V7XN","app-content":"flow_app-content__1tetD","app-infoEdit":"flow_app-infoEdit__1MSa1","app-minimapContainer":"flow_app-minimapContainer__2_1mc","dnd-wrap":"flow_dnd-wrap__31kGe","dnd-rect":"flow_dnd-rect__2MqoE","dnd-circle":"flow_dnd-circle__3bzEX","dnd-mid-circle":"flow_dnd-mid-circle__1pp_U","x6-graph-scroller":"flow_x6-graph-scroller__28RaV",validating:"flow_validating__2_OrF","lds-dual-ring":"flow_lds-dual-ring__2bt-U"}}}]);