(this["webpackJsonpmoderate-react-ts"]=this["webpackJsonpmoderate-react-ts"]||[]).push([[6],{1677:function(e,t,i){"use strict";i.r(t);i(310);var a=i(129),n=(i(131),i(69)),l=i(16),r=(i(277),i(173)),o=i(98),c=(i(773),i(383)),s=i(42),h=i(47),d=i(63),g=i(55),p=i(54),u=i(0),f=i.n(u),m=i(80),b=i(89),j=i(151),O=i(424),v=i(1704),_=i(44),x=i(525),y=i(330),I=i(361),D=i.n(I),S=(i(772),i(521)),w=i(18),C=(i(432),i(149)),A=(i(1706),i(523)),k=i(11),T=C.a.Option;function E(){var e=this;this.state={btnInTableConfig:[],formItemArr:[],columns:[],isOk:!1},this.refreshConfig=function(){var t=e.props.intlData,i=e.props.lightOperateStore,a=i.lightName,n=i.comment;e.setState({formItemArr:[{dataIndex:"lightName",formConfig:{initialValue:a,label:t.light_lightName+":",rules:[{required:!0,message:"".concat(t.light_placeholder_input," ").concat(t.light_lightName)},{max:30,message:t.light_heavy_lightName_1},{pattern:/^[0-9a-zA-z_-]+$/,message:t.light_placeholder_lightName}],inputConfig:{placeholder:t.light_placeholder_lightName,maxLength:30,size:"large"}}},{dataIndex:"comment",formConfig:{initialValue:n,label:t.light_comment+"\uff1a",rules:[],type:"TextArea",inputConfig:{placeholder:t.light_placeholder_comment,autoSize:{minRows:4},maxLength:60}}}],columns:[{title:t.light_searchSelect,dataIndex:"lightType",key:"lightType",editable:!0,width:"130px",formConfig:{rules:[{required:!0,message:"".concat(t.light_placeholder_input," ").concat(t.light_lightType)}],inputConfig:{placeholder:"".concat(t.light_placeholder_select," ").concat(t.light_lightType),maxLength:60,style:{width:"100%"}},optionArr:[[0,t.light_option+"A"],[1,t.light_option+"B"],[2,t.light_option+"C"],[3,t.light_option+"D"],[4,t.light_option+"E"]],type:"Select",render:function(e){var t=e.inputConfig,i=e.optionArr;e.setFieldsValue;return Object(k.jsx)(C.a,Object(w.a)(Object(w.a)({},t),{},{children:i&&i.length>0&&i.map((function(e){return Object(k.jsx)(T,{value:e[0],children:e[1]},e)}))}))}},render:function(e){var i;return(i={},Object(l.a)(i,0,t.light_option+"A"),Object(l.a)(i,1,t.light_option+"B"),Object(l.a)(i,2,t.light_option+"C"),Object(l.a)(i,3,t.light_option+"D"),Object(l.a)(i,4,t.light_option+"E"),i)[e]}},{title:t.light_baseSelect,dataIndex:"baseSelect",key:"baseSelect",editable:!0,width:"170px",formConfig:{optionArr:[[0,t.light_option+"A"],[1,t.light_option+"B"]],inputConfig:{placeholder:t.light_placeholder_aoa,style:{width:"150px"},allowClear:!0},type:"Select"},render:function(e){var i;return(i={},Object(l.a)(i,0,t.light_option+"A"),Object(l.a)(i,1,t.light_option+"B"),i)[e]}},{title:t.light_exclude,dataIndex:"exclude",key:"exclude",editable:!0,width:"100px",render:function(e){return Object(k.jsx)(S.a,{checked:e})},formConfig:{valuePropName:"checked",initialValue:!1,type:"Switch",inputConfig:{}}},{title:t.light_computeNum,dataIndex:"weight",key:"weight",editable:!0,width:"100px",formConfig:{isCustomFormItem:!0,render:function(t){var i=t.getFieldValue,a={lightType:i("lightType"),baseSelect:i("baseSelect"),exclude:i("exclude")};return Object(k.jsx)(A.a,{values:a,handler:e.calcWeight})}},render:function(t,i){return t=t||e.calcWeight(i),Object(k.jsx)("div",{children:t})}}]})},this.selectedRows=[]}var N,R=i(29),L=i(245),F={ADD:1,DETAIL:2,EDIT:3},B=Object(m.c)("lightOperateStore","global")(N=Object(m.d)(N=function(e){Object(g.a)(i,e);var t=Object(p.a)(i);function i(e){var a;Object(s.a)(this,i),(a=t.call(this,e)).formRef=f.a.createRef(),a.title="",a._status=1,a.isDetail=!1,a.id="",a.isEdit=!1,a.refreshConfig=void 0,a.lightId=void 0,a.selectedRows=[],a.handleDelete=function(e){var t=a.props.lightOperateStore,i=t.lightItemArr;(0,t.changeParams)({lightItemArr:i.filter((function(t){return Array.isArray(e)?!e.includes(t.posItemId):"object"===typeof e?t.posItemId!=e.posItemId:t.posItemId!=e}))})},a.save=function(){var e=a.formRef.current.validateFields,t=a.props,i=t.lightOperateStore,n=i.fetchLightAdd,l=i.fetchLightUpdate,r=i.lightItemArr,o=i.isNewAddFlag,s=t.history,h=t.handleExtra,d=t.intlData;if(a.state.editingKey)return c.b.warning(d.light_editting);var g=a.isEdit?l:n;e().then((function(e,t){if(!e&&Object(_.j)(t)){if(!r.length||o&&1==r.length)return void c.b.warning({content:d.light_addOne});g({lightId:a.isEdit?a.lightId:"",lightName:t.lightName,lightItems:r,comment:t.comment}).then((function(){c.b.success({content:d.light_addSave}),h?h():a.setState({isOk:!0},(function(){s.push(Object(L.d)("lightHome"))}))}))}}))},a.handleEdit=function(e){var t=e.editingKey;a.setState({editingKey:t})},a.handleCreate=function(){var e={exclude:!1},t=a.props.lightOperateStore,i=t.changeParams,n=t.lightItemArr;e.posItemId=Date.now(),e.key=e.posItemId,a.setState({editingKey:e.key}),i({lightItemArr:[].concat(Object(o.a)(n),[e])})},a.handleSave=function(e){var t=e.data,i=void 0===t?[]:t;(0,a.props.lightOperateStore.changeParams)({lightItemArr:Object(o.a)(i)})},a.handleDeleteBtnClick=function(){var e=a.props,t=e.lightOperateStore.isNewAddFlag,i=e.intlData;if(a.state.editingKey)return c.b.warning(i.light_editting);t?c.b.warning("\u65b0\u6dfb\u52a0\u7684\u6761\u76ee\u672a\u4fdd\u5b58\uff01"):0===a.selectedRows.length?c.b.warning(i.light_deleteData):r.a.confirm({icon:Object(k.jsx)(O.a,{}),title:i.light_deleteOne,content:i.light_irreversible,okText:i.light_Yes,cancelText:i.light_No,onOk:function(){a.handleDelete(a.selectedRows)}})},a.handleTableSelect=function(e){var t=e.selectedRows,i=void 0===t?[]:t;a.selectedRows=i.map((function(e){return e.posItemId}))},a.handleTableEvent=function(e){var t=e.type,i=e.params;({tableSelect:a.handleTableSelect})[t](i)},a.calcWeight=function(e){var t,i=e.lightType,a=e.baseSelect,n=e.exclude,r=0;return r+=5*(a?1:8),r+=(t={},Object(l.a)(t,0,1),Object(l.a)(t,1,2),Object(l.a)(t,2,3),Object(l.a)(t,3,4),Object(l.a)(t,4,48),t)[i]||0,r*=n?1:10},E.call(Object(d.a)(a));var n=a.props,h=n.location,g=h.pathname,p=void 0===g?"":g,u=h.search,m=n.isDetail,b=n.title;for(var j in a.title=b||Object(_.f)(decodeURIComponent(u),"title"),F)p.includes(j.toLocaleLowerCase())&&(a._status=F[j]);return m&&(a._status=F.DETAIL),a.isDetail=a._status===F.DETAIL,a.id=Object(_.f)(u,"id"),a}return Object(h.a)(i,[{key:"componentDidMount",value:function(){var e=this,t=this.props.lightOperateStore,i=t.fetchInitEx,a=t.fetchTestDataList,n=t.fetchLightDetail;(0,t.initStore)(),this.isEdit?i({lightId:this.id}).then((function(){e.refreshConfig()})).finally((function(){})):this._status===F.ADD?a().then((function(){e.refreshConfig()})):n({id:this.id}).then((function(){e.refreshConfig()}))}},{key:"isPrompt",value:function(){var e;return!(this.state.isOk||this._status!==F.ADD||!(null===(e=this.formRef.current)||void 0===e?void 0:e.getFieldsValue))&&Object.entries(this.formRef.current.getFieldsValue()).some((function(e){return e[1]}))}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props.intlData;this.state.intlData!==t&&this.setState({intlData:t},(function(){e.refreshConfig()}))}},{key:"render",value:function(){var e=this,t=this.props,i=(t.form,t.lightOperateStore),l=t.handleExtra,r=t.intlData,o=i.lightItemArr,c=i.isNewAddFlag,s=this.state,h=s.formItemArr,d=s.columns,g=s.editingKey;return Object(k.jsxs)("div",{className:"posEditContent",children:[Object(k.jsx)(b.a,{when:this.isPrompt(),message:function(e){return"\u5f53\u524d\u6b63\u5728\u7f16\u8f91\uff0c\u4f60\u786e\u5b9a\u79bb\u5f00\u8fd9\u4e2a\u9875\u9762\u4e48\uff1f"}}),Object(k.jsxs)("div",{className:"topWrapper",children:[Object(k.jsx)("div",{className:"title",children:this.title}),this._status===F.DETAIL&&Object(k.jsx)(j.c,{to:Object(L.d)("lightEdit ",{search:"?title=".concat(r["posPage.posEditTitle"],"&id=").concat(this.id)}),children:Object(k.jsx)(n.a,{className:"savaBtn",type:"primary",icon:Object(k.jsx)(v.a,{}),onClick:function(){e.save()},children:r["posPage.edit"]})}),Object(k.jsx)(a.a,{ref:this.formRef,layout:"vertical",children:this.formRef.current&&Object(k.jsx)(x.c,{isJustShow:this.isDetail,form:this.formRef.current,dataSource:h})})]}),Object(k.jsx)(x.f,{title:r.light_itemListTitle,children:Object(k.jsx)(x.b,{transformNewRowData:function(t){return t.weight=e.calcWeight(t),t},isJustShow:this.isDetail,isNewAddFlag:c,pageStore:i,handleEvent:this.handleTableEvent,handleCreate:this.handleCreate,handleEdit:this.handleEdit,handleSave:this.handleSave,handleTableSelect:this.handleTableSelect,handleDelete:this.handleDelete,handleDeleteBtnClick:this.handleDeleteBtnClick,data:Object(R.p)(o),columns:d,editingKey:g,other:{scroll:{x:1200}}})}),Object(k.jsxs)("div",{className:"btnTable",children:[Object(k.jsx)(n.a,{onClick:D()(this.save),style:{marginRight:10},type:"primary",children:r.light_save}),Object(k.jsx)(n.a,{onClick:function(){l?l():e.props.history.goBack()},children:r.light_cancel})]})]})}}]),i}(u.Component))||N)||N;t.default=Object(y.a)("light")(B)},1706:function(e,t,i){}}]);